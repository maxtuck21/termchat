{
  "name": "facebook-chat-api",
  "version": "0.2.10",
  "description": "Facebook chat API that doesn't rely on XMPP.  Will NOT be deprecated April 30th 2015.",
  "main": "server.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1",
    "start": "node server.js"
  },
  "repository": {
    "type": "git",
    "url": "git://github.com/Schmavery/facebook-chat-api.git"
  },
  "keywords": [
    "facebook",
    "chat",
    "api"
  ],
  "bugs": {
    "url": "https://github.com/Schmavery/facebook-chat-api/issues"
  },
  "author": {
    "name": "Avery, David, Maude, Benjamin"
  },
  "license": "MIT",
  "dependencies": {
    "bluebird": "^2.9.27",
    "cheerio": "^0.19.0",
    "npmlog": "^1.2.0",
    "request": "^2.53.0"
  },
  "engines": {
    "node": "0.12.x"
  },
  "readme": "# Facebook Chat API\nThe Official Facebook Chat API uses XMPP and is deprecated as of April 30th 2015. This is a non-official API that doesn't use XMPP.\nAs of right now, the only way to automate the chat functionalities is to emulate the browser. This means doing the exact same GET/POST requests and tricking Facebook into thinking we're accessing the website normally. Because we're doing it this way, this API won't work with an auth token but requires the credentials of a Facebook account.\n\n_Side note_: if you want a larger example you should head over to [Marc Zuckerbot](https://github.com/bsansouci/marc-zuckerbot)\n\n## Install\n```bash\nnpm install facebook-chat-api\n```\n\n## Example Usage\n```javascript\nvar login = require(\"facebook-chat-api\");\n\n// Create simple echo bot\nlogin({email: \"FB_EMAIL\", password: \"FB_PASSWORD\"}, function callback (err, api) {\n    if(err) return console.error(err);\n    \n    api.listen(function callback(err, message) {\n        api.sendMessage(message.body, message.thread_id);\n    });\n});\n\n\n```\n\n\n## Documentation\n* [`login`](#login)\n* [`api.listen`](#listen)\n* [`api.setOptions`](#setOptions)\n* [`api.getUserId`](#getUserId)\n* [`api.getCurrentUserId`](#getCurrentUserId)\n* [`api.sendMessage`](#sendMessage)\n* [`api.markAsRead`](#markAsRead)\n* [`api.sendSticker`](#sendSticker)\n* [`api.setTitle`](#setTitle)\n* [`api.getUserInfo`](#getUserInfo)\n* [`api.getFriendsList`](#getFriendsList)\n* [`api.getThreadList`](#getThreadList)\n* [`api.getAccessToken`](#getAccessToken)\n* [`api.addUserToGroup`](#addUserToGroup)\n* [`api.removeUserFromGroup`](#removeUserFromGroup)\n* [`api.sendTypingIndicator`](#sendTypingIndicator)\n\n## &#9888; Deprecated &#9888;\n* [`api.sendDirectMessage`](#sendDirectMessage)\n* [`api.sendDirectSticker`](#sendDirectSticker)\n\n---------------------------------------\n\n<a name=\"login\" />\n### login(emailAndPassword, [options], callback)\n\nThis function is returned by require(...) and is the main entry point to the API. \n\nLogs into facebook given the right credentials.\n\nIf it succeeds, callback will be called with a null object (for potential errors) and with an object containing all the available functions.\n\nIf it fails, callback will be called with an error object.\n\n__Arguments__\n\n* `emailAndPassword` - An object containing the fields `email` and `password` used to login.\n* `options` - An object representing options to use when logging in (as described in [api.setOptions](#setOptions)).\n* `callback(err, api)` - A callback called when login is done (successful or not). `err` is an object containing a field `error`.\n\n__Example__\n\n```js\nlogin({email: \"FB_EMAIL\", password: \"FB_PASSWORD\"}, function callback (err, api) {\n    if(err) return console.error(err);\n    // Here you can use the api\n});\n```\n\n\n---------------------------------------\n\n<a name=\"listen\" />\n### api.listen(callback)\n\nWill call callback when a new message it received on this account. \nBy default this won't receive events (joining/leaving a chat, title change etc...) but it can be activated with `api.setOptions({listenEvents: true})`.\n\n__Arguments__\n\n- `callback(error, message, stopListening)` - A callback called every time the logged-in account receives a new message. `stopListening` is a function that will stop the `listen` loop and is guaranteed to prevent any future calls to the callback given to `listen`. An immediate call to `stopListening` when an error occurs will prevent the listen function to continue. `message` is an object containing the following fields:\n    * `sender_name` - First and last name of the person who just sent the message.\n    * `sender_id` - The id of the person who sent the message in the chat with thread_id.\n    * `participant_ids` - An array containing the ids of everyone in the thread (sender included).\n    * `participant_names` - An array containing only the first names of the other participants in the thread (sender included).\n    * `body` - The string corresponding to the message that was just received.\n    * `thread_id` - The thread_id representing the thread in which the message was sent.\n    * `coordinates` - An object containing `latitude`, `longitude`, and `accuracy`.\n    * `type` - The string `\"message\"`, `\"sticker\"`, `\"file\"`, `\"photo\"`, `\"animated_image\"`, or `\"event\"` (if applicable, see below).\n\nIf `type` is `\"sticker\"` there will be a `sticker_id` and `sticker_url` field instead of `body`.\n\nIf `type` is `file` there will be a `name` and a `file_url` instead of `body`.\n\nIf `type` is `photo` there will be `name`,`hires_url`, `thumbnail_url`, and `preview_url` instead of `body`.\n\nIf `type` is `animated_image` there will be `name`, `url`, and `preview_url`  instead of `body`.\n\nIf enabled this will also handle events. In this case, `message` will be either a message (see above) or an event object with the following fields\n- `type` - The string `\"event\"`\n- `thread_id` - The thread_id representing the thread in which the message was sent.\n- `log_message_type` - String representing the type of event (`\"log:thread-name\"`, `\"log:unsubscribe\"`, `\"log:subscribe\"`, ...)\n- `log_message_data` - Data relevant to the event.\n- `log_message_body` - String printed in the chat.\n- `author` - The person who performed the event.\n\n__Example__\n\n```js\n// Simple echo bot. He'll repeat anything that you say.\n// Will stop when you say '/stop'\n\nlogin({email: \"FB_EMAIL\", password: \"FB_PASSWORD\"}, function callback (err, api) {\n    if(err) return console.error(err);\n\n    api.setOptions({listenEvents: true});\n\n    api.listen(function(err, event, stopListening) {\n        if(err) return console.error(err);\n\n        switch(event.type) {\n          case \"message\":\n            if(event.body === '/stop') {\n              api.sendMessage(\"Goodbye...\", event.thread_id);\n              return stopListening();\n            }\n            api.markAsRead(event.thread_id, function(err) {\n              if(err) console.log(err);\n            });\n            api.sendMessage(\"TEST BOT: \" + event.body, event.thread_id);\n            break;\n          case \"event\":\n            console.log(event);\n            break;\n        }\n    });\n});\n```\n\n---------------------------------------\n\n<a name=\"setOptions\" />\n### api.setOptions(options)\n\nSets various configurable options for the api.\n\n__Arguments__\n\n* `options` - An object containing the new values for the options that you want\n  to set.  If the value for an option is unspecified, it is unchanged. The following options are possible.\n    - `logLevel` - The desired logging level as determined by npmlog.  Choose\n      from either `\"silly\"`, `\"verbose\"`, `\"info\"`, `\"http\"`, `\"warn\"`, `\"error\"`, or `\"silent\"`.\n    - `selfListen` - (Default `false`) Set this to `true` if you want your api\n      to receive messages from its own account.  This is to be used with\n      caution, as it can result in loops (a simple echo bot will send messages\n      forever).\n    - `listenEvents` - (Default `false`) Will make api.listen also handle events.\n    - `pageId` - (Default empty) Makes listen only receive messages through the page specified by that ID. Also makes sendMessage and sendSticker send from the page.\n\n__Example__\n\n```js\n// Simple echo bot. This will send messages forever.\n\nlogin({email: \"FB_EMAIL\", password: \"FB_PASSWORD\"}, function callback (err, api) {\n    if(err) return console.error(err);\n    \n    api.setOptions({\n      selfListen: true,\n      logLevel: \"silent\"\n    });\n\n    api.listen(function(err, message, stopListening){\n        if(err) return console.error(err);\n\n        api.sendMessage(message.body, message.thread_id);\n    });\n});\n```\n\n---------------------------------------\n\n<a name=\"getUserId\" />\n### api.getUserId(name, callback)\n\nGiven a person's full name will do a Facebook Graph search and return all the ids ordered by however Facebook wants to order them.\n\n__Arguments__\n\n* `name` - A string being the name of the person you're looking for.\n* `callback(err, obj)` - A callback called when the search is done (either with an error or with the resulting object). `obj` is an array which contains all of the users that facebook graph search found, ordered by \"importance\".\n\n__Example__\n\n```js\nlogin({email: \"FB_EMAIL\", password: \"FB_PASSWORD\"}, function callback (err, api) {\n    if(err) return console.error(err);\n    \n    api.getUserId(\"Marc Zuckerbot\", function(err, data) {\n        if(err) return callback(err);\n        \n        // Send the message to the best match (best by Facebook's criteria)\n        var thread_id = data[0].uid;\n        api.sendMessage(msg, thread_id);\n    });\n});\n```\n\n---------------------------------------\n\n<a name=\"getCurrentUserId\" />\n### api.getCurrentUserId()\n\nReturns the currently logged-in user's Facebook user ID.\n\n---------------------------------------\n\n<a name=\"sendMessage\" />\n### api.sendMessage(message, thread_id, [callback])\n\nSends the given message to the thread_id.\n\n__Arguments__\n\n* `message` - A string being the message to be sent to the given thread_id.\n* `thread_id` - A string or number representing a thread. It happens to be someone's userId in the case of a one to one conversation. \n* `callback(err, obj)` - A callback called when sending the message is done (either with an error or with an confirmation object). `obj` contains only the thread_id where the message was sent.\n\n__Tip__: to find your own ID, go to your own profile on Facebook and replace 'www' by 'graph' in the URL.\n\n__Example__\n\n```js\nlogin({email: \"FB_EMAIL\", password: \"FB_PASSWORD\"}, function callback (err, api) {\n    if(err) return console.error(err);\n    \n    var yourID = 0000000000000;\n    api.sendMessage(\"Hey!\", yourID);\n});\n```\n\n---------------------------------------\n\n<a name=\"markAsRead\" />\n### api.markAsRead(thread\\_id, callback)\n\nGiven a thread_id will mark all the unread messages as read. Facebook will take a couple of seconds to show that you've read the messages.\n\n__Arguments__\n\n* `thread_id` - The id of the thread in which you want to mark the messages as read.\n* `callback(err)` - A callback called when the operation is done maybe with an object representing an error.\n\n__Example__\n\n```js\nvar login = require(\"facebook-chat-api\");\n\nlogin({email: \"FB_EMAIL\", password: \"FB_PASSWORD\"}, function callback (err, api) {\n    if(err) return console.error(err);\n  \n    api.listen(function callback(err, message) {\n        // Marks message as read immediately after they're sent\n        api.markAsRead(message.thread_id);\n    });\n});\n```\n\n---------------------------------------\n\n<a name=\"sendSticker\" />\n### api.sendSticker(sticker\\_id, thread\\_id, [callback])\n\nSends the given sticker_id to the thread_id.\n\n__Arguments__\n\n* `sticker_id` - A string or number representing the sticker to be sent to the given thread_id.\n* `thread_id` - A string or number representing a thread. It happens to be someone's userId in the case of a one to one conversation. \n* `callback(err, obj)` - A callback called when sending the message is done (either with an error or with an confirmation object). `obj` contains only the thread_id where the message was sent.\n\n__Tip__: to find your own ID, go to your own profile on Facebook and replace 'www' by 'graph' in the URL.\n\n__Example__\n\n```js\nlogin({email: \"FB_EMAIL\", password: \"FB_PASSWORD\"}, function callback (err, api) {\n    if(err) return console.error(err);\n    \n    var yourID = 0000000000000;\n    api.sendMessage(767334526626290, yourID);\n});\n```\n\n---------------------------------------\n\n<a name=\"setTitle\" />\n### api.setTitle(newTitle, thread_id, [callback])\n\nSets the title of the group chat with thread id thread_id to newTitle.\n\nNote: This will not work if the thread id corresponds to a single-user chat or\nif the bot is not in the group chat.\n\n__Arguments__\n\n* `newTitle` - A string representing the new title.\n* `thread_id` - A string or number representing a thread. It happens to be someone's userId in the case of a one to one conversation. \n* `callback(err, obj)` - A callback called when sending the message is done (either with an error or with an confirmation object). `obj` contains only the thread_id where the message was sent.\n\n---------------------------------------\n\n<a name=\"getUserInfo\" />\n### api.getUserInfo(ids, callback)\n\nWill get some information about the given users.\n\n__Arguments__\n\n* `ids` - Either a string/number for one ID or an array of strings/numbers for a batched query.\n* `callback(err, obj)` - A callback called when the query is done (either with an error or with an confirmation object). `obj` is a mapping from userId to another object containing the following properties: id, name, firstName, vanity, thumbSrc, uri, gender, type, is_friend, is_birthday, searchTokens, alternateName.\n\n__Example__\n\n```js\nlogin({email: \"FB_EMAIL\", password: \"FB_PASSWORD\"}, function callback (err, api) {\n    if(err) return console.error(err);\n    \n    api.getUserInfo([1, 2, 3, 4], function(err, ret) {\n      if(err) return console.error(err);\n\n      for(var prop in ret) {\n        if(ret.hasOwnProperty(prop) && ret[prop].is_birthday) {\n          api.sendMessage(\"Happy birthday :)\", prop);\n        }\n      }\n    });\n});\n```\n\n---------------------------------------\n\n<a name=\"getFriendsList\" />\n### api.getFriendsList(id, callback)\n\n__Warning__: this function takes a longer time than others to answer because it pulls the friends in batches of 20 (blindly following how the UI pulls the friends list). It might take a couple seconds if you have >1000 friends.\n\n__Warning 2__: this will only work if you're friends with the person or if the person didn't set their friends list as being private information.\n\nGiven the id of a person, will return an array of ids of all its friends.\n\n__Arguments__\n\n* `id` - The id of a person.\n* `callback(err, arr)` - A callback called when the query is done (either with an error or with an confirmation object). `arr` is an array containing all the ids of the person's friends. You can get more information about those people by then calling getUserInfo with the array (this will return faster because it'll be done in one request).\n\n__Example__\n\n```js\nlogin({email: \"FB_EMAIL\", password: \"FB_PASSWORD\"}, function callback (err, api) {\n  if(err) return console.error(err);\n  \n  api.getFriendsList(1216678154, function(err, data) {\n    if(err) return console.error(err);\n\n    console.log(data.length);\n  });\n});\n```\n\n---------------------------------------\n\n<a name=\"getThreadList\" />\n### api.getThreadList(start, end, callback)\n\nWill return information about threads.\n\n__Arguments__\n\n* `start` - Start index in the list of recently used threads.\n* `end` - End index.\n* `callback(err, arr)` - A callback called when the query is done (either with an error or with an confirmation object). `arr` is an array of thread object containing the following properties: thread_id, thread_fbid, other_user_fbid, last_action_id, participants, former_participants, name, snippet, snippet_has_attachment, is_forwarded_snippet, snippet_attachments, snippet_sender, unread_count, message_count, image_src, timestamp_absolute, timestamp_datetime, timestamp_relative, timestamp_time_passed, timestamp, server_timestamp, mute_settings, is_canonical_user, is_canonical, canonical_fbid, is_subscribed, root_message_threading_id, folder, is_archived, mode, recipients_loadable, name_conversation_sheet_dismissed, has_email_participant, read_only.\n\n---------------------------------------\n\n<a name=\"getAccessToken\" />\n### api.getAccessToken()\n\nSynchronously returns an access token to the Facebook Graph API.\n\nThis is a bit of a hack because it's using the Graph API Explorer's app ID. It has all permissions so drive safely.\n\n__Example__\n\n```js\nvar fb = require('fb');\n\nlogin({email: \"FB_EMAIL\", password: \"FB_PASSWORD\"}, function callback (err, api) {\n    if(err) return console.error(err);\n    \n    fb.setAccessToken(api.getAccessToken());\n    fb.api('/me', 'get', function (res) {\n        if(!res || res.error) return console.error(res ? res.error : \"error\");\n        console.log('me: ', res);\n    });\n});\n```\n\n\n---------------------------------------\n\n<a name=\"addUserToGroup\" />\n### api.addUserToGroup(user\\_id, thread\\_id, [callback])\n\nAdds a user (or array of users) to a group chat.\n\n__Arguments__\n\n* `user_id` - User ID or array of user IDs.\n* `thread_id` - Group chat ID.\n* `callback(err)` - A callback called when the query is done (either with an error or with no arguments).\n\n---------------------------------------\n\n<a name=\"removeUserFromGroup\" />\n### api.removeUserFromGroup(user\\_id, thread\\_id, [callback])\n\nRemoves a user from a group chat.\n\n__Arguments__\n\n* `user_id` - User ID.\n* `thread_id` - Group chat ID.\n* `callback(err)` - A callback called when the query is done (either with an error or with no arguments).\n\n---------------------------------------\n\n<a name=\"sendTypingIndicator\" />\n### api.sendTypingIndicator(thread\\_id, [callback])\n\nSends a \"USERNAME is typing\" indicator to other members of the thread indicated by thread\\_id.  This indication will disappear after 30 second or when the `end` function is called.\n\n__Arguments__\n\n* `thread_id` - Group chat ID.\n* `callback(err, end)` - A callback called when the query is done (either with an error or with null followed by a function `end` described above).\n\n## Deprecated\n\n---------------------------------------\n\n<a name=\"sendDirectMessage\" />\n### api.sendDirectMessage(message, nameOrUserId, callback)\n\n__Warning__: This function is ambiguous. It'll send messages to facebook's best match when searching for a person called `nameOrUserId`. If all the returned matches aren't people (pages, events etc...), `sendDirectMessage` will call the callback with an error. For this reason, the callback is required.\n\nSimilar to `sendMessage` but if `nameOrUserId` is a string, it will query Facebook's search engine to find the person that matches the closest the given name. 'the closest' means that given what facebook knows about you, it'll give priority to friends and friends of friends etc... If `nameOrUserId` is a number, it'll just call `sendMessage`.\n\n__Arguments__\n\n* `message` - A string being the message to be sent to the given `nameOrUserId`\n* `nameOrUserId` - A string or number representing either a person or a thread. If it's a string, `sendDirectMessage` will do a search for that person's name and will send the given `message` to the closest match.\n* `callback(err, obj)` - A callback called when sending the message is done (either with an error or with an confirmation object). `err` might occur if you did a typo in `nameOrUserId` and Facebook didn't return any valid users.  `obj` contains only the thread_id where the message was sent.\n\n__Example__\n\n```js\nlogin({email: \"FB_EMAIL\", password: \"FB_PASSWORD\"}, function callback (err, api) {\n    if(err) return console.error(err);\n    \n    var yourName = \"Marc Zuckerbot\";\n    api.sendDirectMessage(\"Hey John!\", yourName, function(err, data){\n        if(err) console.error(err);\n    });\n});\n```\n\n---------------------------------------\n\n<a name=\"sendDirectSticker\" />\n### api.sendDirectSticker(sticker_id, nameOrUserId, callback)\n\n__Warning__: This function is also ambiguous (look at [`sendDirectMessage`](#sendDirectMessage)) and therefore a callback is required.\n\nSame as sendDirectMessage but for stickers.\n",
  "readmeFilename": "README.md",
  "_id": "facebook-chat-api@0.2.10",
  "_from": "facebook-chat-api@"
}
